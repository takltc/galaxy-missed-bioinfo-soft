<tool id="expansionhunter_denovo_motif" name="ExpansionHunter Denovo Motif Analysis" version="0.9.0+galaxy0" profile="21.05">
    <description>Case-control or outlier analysis by repeat motif</description>
    <macros>
        <token name="@TOOL_VERSION@">0.9.0</token>
        <token name="@GALAXY_VERSION@">galaxy0</token>
    </macros>
    <requirements>
        <requirement type="package" version="@TOOL_VERSION@">expansionhunterdenovo</requirement>
        <container type="docker">quay.io/biocontainers/expansionhunterdenovo:0.9.0--h6ac36c1_11</container>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
        #if str($analysis_type.analysis_mode) == "casecontrol":
            python3 \$CONDA_PREFIX/share/ExpansionHunterDenovo-@TOOL_VERSION@/scripts/casecontrol.py motif
                --manifest '$analysis_type.manifest'
                --multisample-profile '$multisample_profile'
                --output motif_results.tsv
        #else:
            python3 \$CONDA_PREFIX/share/ExpansionHunterDenovo-@TOOL_VERSION@/scripts/outlier.py motif
                --manifest '$analysis_type.manifest'
                --multisample-profile '$multisample_profile'
                --output motif_results.tsv
        #end if
    ]]></command>
    <inputs>
        <param name="multisample_profile" type="data" format="json" label="Multisample Profile" help="Combined profile from the merge step"/>
        <conditional name="analysis_type">
            <param name="analysis_mode" type="select" label="Analysis Mode">
                <option value="casecontrol" selected="true">Case-Control Analysis</option>
                <option value="outlier">Outlier Analysis</option>
            </param>
            <when value="casecontrol">
                <param name="manifest" type="data" format="tabular" label="Manifest file" help="TSV file with columns: sample_name, case/control status, path_to_profile"/>
            </when>
            <when value="outlier">
                <param name="manifest" type="data" format="tabular" label="Manifest file" help="TSV file with columns: sample_name, case/control status, path_to_profile"/>
            </when>
        </conditional>
    </inputs>
    <outputs>
        <data name="motif_results" format="tabular" from_work_dir="motif_results.tsv" label="${tool.name} on ${on_string}: Motif Results"/>
    </outputs>
    <tests>
        <test expect_num_outputs="1">
            <param name="multisample_profile" value="merged.json"/>
            <conditional name="analysis_type">
                <param name="analysis_mode" value="casecontrol"/>
                <param name="manifest" value="manifest.tsv"/>
            </conditional>
            <output name="motif_results" file="expected_motif.tsv" compare="sim_size"/>
        </test>
    </tests>
    <help><![CDATA[
**ExpansionHunter Denovo - Motif Analysis**
============================================

Perform statistical analysis to identify significant repeat enrichment by motif pattern.

**Locus vs Motif Analysis**
---------------------------

- **Locus analysis**: Identifies specific genomic locations of expansions using anchored IRRs
- **Motif analysis**: Identifies overall enrichment for repeats with specific motifs using paired IRRs

Motif analysis is useful when:

- The exact genomic location is unknown
- Multiple loci share the same repeat motif
- Expansions are very long (exceeding fragment length)

**Analysis Modes**
------------------

**Case-Control Analysis**
    Compares paired IRR counts between cases and controls.

**Outlier Analysis**
    Identifies samples with unusually high paired IRR counts for specific motifs.

**Output**
----------

Ranked list of repeat motifs with statistical significance measures.

**Citation**
------------

Dolzhenko E, et al. ExpansionHunter Denovo: a computational method for locating known and novel repeat expansions in short-read sequencing data. Genome Biol. 2020;21(1):102.

    ]]></help>
    <citations>
        <citation type="doi">10.1186/s13059-020-02017-z</citation>
    </citations>
</tool>
